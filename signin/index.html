<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Cotter Verification Example</title>
    <link href="style.css" rel="stylesheet" />

    <!-- 1️⃣ Get Cotter SDK -->
    <script
      src="https://unpkg.com/cotter@0.3.23/dist/cotter.min.js"
      type="text/javascript"
    ></script>
  </head>
  <body>
    <!-- 2️⃣ Setup a div to contain the form -->
    <div id="cotter-form-container" style="width: 300px; height: 300px;"></div>

    <!-- 3️⃣ Show the form -->
    <script>
      var cotter = new Cotter("3ce61596-ad16-4c36-97d5-2ca496804b58"); // 👈 Specify your API KEY ID here

      cotter
        .signInWithOTP()
        .showEmailForm() // to send OTP to a phone number use .showPhoneForm()
        .then((payload) => {
          // Read what Cotter Returns
          var respDiv = document.getElementById("user-response");
          respDiv.innerHTML = `
            <div class="success">Verification Success</div> <br/>
            <div class="title">User info from Cotter:</div>
            <pre>${JSON.stringify(payload, null, 4)}</pre>
          `;
          refresh();
        });
    </script>

    <div id="user-info"></div>
    <div id="user-response"></div>
  </body>
  <script>
    function refresh() {
      var respDiv = document.getElementById("user-info");
      var cotter = new Cotter("3ce61596-ad16-4c36-97d5-2ca496804b58"); // 👈 Specify your API KEY ID here
      var user = cotter.getLoggedInUser();
      console.log(user);
      if (user) {
        document.getElementById("user-info").innerHTML = `
        <div class="title">Welcome, ${user.identifier}</div>
      `;
      } else {
        document.getElementById("user-info").innerHTML = `
        <div class="title">You're not yet authenticated</div>
      `;
      }
    }
    refresh();
  </script>
</html>
